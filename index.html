<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitor de QR Code</title>
  <!-- CDN da biblioteca html5-qrcode -->
  <script src="./html5-qrcode.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f7f7f7;
    }
    #qr-reader {
      width: 100%;
      max-width: 500px;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: white;
    }
    #resultado {
      margin-top: 20px;
      font-size: 1.2em;
      color: #333;
    }
    #link {
      margin-top: 20px;
      font-size: 1em;
      color: #0066cc;
      text-decoration: none;
    }
    #link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <div>
    <h2>Leitor de QR Code</h2>
    <!-- Div onde a câmera será exibida -->
    <div id="qr-reader"></div>
    <!-- Local para exibir o resultado do QR Code -->
    <div id="resultado">Escaneie um QR Code!</div>
    <!-- Local para exibir o link clicável -->
    <a id="link" href="#" target="_blank" style="display: none;">Clique aqui para acessar o QR Code</a>
  </div>

  <script>
    // Função para tratar o sucesso ao escanear o QR Code
    function onScanSuccess(decodedText, decodedResult) {
      // Exibe o conteúdo do QR Code
      document.getElementById('resultado').textContent = 'QR Code Escaneado: ' + decodedText;

      // Exibe o link clicável
      const linkElement = document.getElementById('link');
      linkElement.href = decodedText;  // Define o link para a URL do QR Code
      linkElement.textContent = 'Clique aqui para acessar a página do QR Code';  // Texto do link
      linkElement.style.display = 'inline';  // Torna o link visível
    }

    // Função para tratar erro (caso a câmera não possa ser acessada)
    function onScanError(errorMessage) {
      console.warn(`Erro de leitura: ${errorMessage}`);
    }

    // Inicializa a câmera e começa a leitura do QR Code
    function iniciarLeituraQRCode() {
      const config = {
        fps: 10, // Frames por segundo para leitura (ajustável conforme necessário)
        qrbox: 250, // Tamanho da área do QR Code na tela
      };

      const qrCodeReader = new Html5Qrcode("qr-reader");

      // Inicia a leitura da câmera
      qrCodeReader.start(
        { facingMode: "environment" }, // Preferir a câmera traseira
        config,
        onScanSuccess,
        onScanError
      ).catch(err => {
        console.error("Erro ao iniciar a câmera", err);
        document.getElementById('resultado').textContent = "Falha ao acessar a câmera. Tente novamente.";
      });
    }

    // Chama a função para iniciar a leitura
    iniciarLeituraQRCode();
  </script>

</body>
</html>
